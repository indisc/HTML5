/*
jCanvas v3.2
Copyright 2011, Caleb Evans

Licensed under the MIT license
http://calebevans.me/projects/jcanvas/license.html
*/
(function(d,a,c,e){function b(f,g){if(f===e){b.prefs=b.defaults}else{if(g===true){b.defaults=d.extend({},b.defaults,f);b.prefs=d.extend({},b.defaults)}else{b.prefs=d.extend({},b.prefs,f)}}return this}b.defaults={width:0,height:0,cornerRadius:0,fillStyle:"transparent",strokeStyle:"transparent",strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",rounded:false,shadowX:0,shadowY:0,shadowBlur:3,shadowColor:"transparent",opacity:1,compositing:"source-over",mask:false,x:0,y:0,x1:0,y1:0,x2:0,y2:0,radius:0,start:0,end:360,ccw:false,inDegrees:true,fromCenter:true,closed:false,sides:3,angle:0,text:"",font:"normal 12pt sans-serif",align:"center",baseline:"middle",source:"",repeat:"repeat"};b.prefs=d.extend({},b.defaults);b.retro=false;b.setGlobals=function(f,g){f.fillStyle=g.fillColor||g.fillStyle;f.strokeStyle=g.strokeColor||g.strokeStyle;f.lineWidth=g.strokeWidth;f.lineCap=g.strokeCap;f.lineJoin=g.strokeJoin;if(g.rounded===true){f.lineCap="round";f.lineJoin="round"}f.shadowOffsetX=g.shadowX;f.shadowOffsetY=g.shadowY;f.shadowBlur=g.shadowBlur;f.shadowColor=g.shadowColor;f.globalAlpha=g.globalAlpha||g.opacity;f.globalCompositeOperation=g.compositing};b.closePath=function(f,g){if(g.mask===true){f.save();f.clip()}if(g.closed===true){f.closePath();f.fill();f.stroke()}else{f.fill();f.stroke();f.closePath()}};b.checkUnits=function(f){if(f.inDegrees===true){return c.PI/180}else{return 1}};b.rotate=function(g,i,h,f){if(i.fromCenter===false){i.x+=h/2;i.y+=f/2}i.toRad=b.checkUnits(i);g.save();g.translate(i.x,i.y);g.rotate(i.angle*i.toRad);g.translate(-i.x,-i.y)};d.fn.loadCanvas=function(f){return this[0].getContext(f||"2d")};d.fn.draw=function(h){var f,g;for(g=0;g<this.length;g+=1){f=this[g].getContext("2d");h.call(this[g],f)}};d.fn.gradient=function(g){var f=this.loadCanvas(),m=d.extend({},b.prefs,g),l,k=0,j,h=1;if(m.r1!==e&&m.r2!==e){l=f.createRadialGradient(m.x1,m.y1,m.r1,m.x2,m.y2,m.r2)}else{l=f.createLinearGradient(m.x1,m.y1,m.x2,m.y2)}while(m["c"+h]!==e){k+=1;h+=1}for(h=1;h<=k;h+=1){j=c.round((100/(k-1))*(h-1))/100;if(m["s"+h]===e){m["s"+h]=j}l.addColorStop(m["s"+h],m["c"+h])}return l};d.fn.pattern=function(h){var f=this.loadCanvas(),l=d.extend({},b.prefs,h),j,g=a.createElement("img");g.src=l.source;function i(){if(g.complete===true){j=f.createPattern(g,l.repeat);return true}else{return false}}function k(){i();if(l.load){l.load(j)}}if(l.load){g.onload=k}else{if(i()===false){g.onload=k}}return j};d.fn.clearCanvas=function(g){var f,h,i=d.extend({},b.prefs,g);for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");b.setGlobals(f,i);i.width=i.width=this[h].width;i.height=i.height=this[h].height;b.rotate(f,i,i.width,i.height);if(g===e){i.x=i.width/2;i.y=i.height/2}f.beginPath();f.clearRect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);f.closePath()}return this};d.fn.saveCanvas=function(){var f,g;for(g=0;g<this.length;g+=1){f=this[g].getContext("2d");f.save()}return this};d.fn.restoreCanvas=function(){var f,g;for(g=0;g<this.length;g+=1){f=this[g].getContext("2d");f.restore()}return this};d.fn.scaleCanvas=function(g){var f,h,i=d.extend({},b.prefs,g);for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");f.save();f.translate(i.x,i.y);f.scale(i.width,i.height);f.translate(-i.x,-i.y)}return this};d.fn.translateCanvas=function(g){var f,h,i=d.extend({},b.prefs,g);for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");f.save();f.translate(i.x,i.y)}return this};d.fn.rotateCanvas=function(g){var f,h,i=d.extend({},b.prefs,g);i.toRad=b.checkUnits(i);for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");f.save();f.translate(i.x,i.y);f.rotate(i.angle*i.toRad);f.translate(-i.x,-i.y)}return this};d.fn.drawRect=function(k){var n,j,i=d.extend({},b.prefs,k),h,m,g,l,f;for(j=0;j<this.length;j+=1){n=this[j].getContext("2d");b.setGlobals(n,i);b.rotate(n,i,i.width,i.height);if(i.cornerRadius){h=i.x-i.width/2;m=i.y-i.height/2;g=i.x+i.width/2;l=i.y+i.height/2;f=i.cornerRadius||i.strokeWidth;if((g-h)-(2*f)<0){f=(g-h)/2}if((l-m)-(2*f)<0){f=(l-m)/2}n.beginPath();n.moveTo(h+f,m);n.lineTo(g-f,m);n.arc(g-f,m+f,f,270*i.toRad,360*i.toRad,false);n.lineTo(g,l-f);n.arc(g-f,l-f,f,0,90*i.toRad,false);n.lineTo(h+f,l);n.arc(h+f,l-f,f,90*i.toRad,180*i.toRad,false);n.lineTo(h,m+f);n.arc(h+f,m+f,f,180*i.toRad,270*i.toRad,false);n.fill();n.stroke();n.closePath()}else{n.beginPath();n.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);n.restore();b.closePath(n,i)}}return this};d.fn.drawArc=function(g){var f,h,i=d.extend({},b.prefs,g);if(i.inDegrees===false&&i.end===360){i.end*=c.PI/180}for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");b.setGlobals(f,i);b.rotate(f,i,i.radius,i.radius);f.beginPath();f.arc(i.x,i.y,i.radius,(i.start*i.toRad)-(c.PI/2),(i.end*i.toRad)-(c.PI/2),i.ccw);f.restore();b.closePath(f,i)}return this};d.fn.drawEllipse=function(g){var f,i,j=d.extend({},b.prefs,g),h=j.width*(4/3);for(i=0;i<this.length;i+=1){f=this[i].getContext("2d");b.setGlobals(f,j);b.rotate(f,j,j.width,j.height);f.beginPath();f.moveTo(j.x,j.y-j.height/2);f.bezierCurveTo(j.x-h/2,j.y-j.height/2,j.x-h/2,j.y+j.height/2,j.x,j.y+j.height/2);f.bezierCurveTo(j.x+h/2,j.y+j.height/2,j.x+h/2,j.y-j.height/2,j.x,j.y-j.height/2);f.restore();b.closePath(f,j)}return this};d.fn.drawLine=function(h){var g,k,m=d.extend({},b.prefs,h),f=2,j=0,i=0;for(k=0;k<this.length;k+=1){g=this[k].getContext("2d");b.setGlobals(g,m);g.beginPath();g.moveTo(m.x1,m.y1);while(1){j=m["x"+f];i=m["y"+f];if(j!==e&&i!==e){g.lineTo(j,i)}else{break}f+=1}b.closePath(g,m)}return this};d.fn.drawQuad=function(k){var o,j,i=d.extend({},b.prefs,k),h=2,g=0,f=0,n=0,m=0;for(j=0;j<this.length;j+=1){o=this[j].getContext("2d");b.setGlobals(o,i);o.beginPath();o.moveTo(i.x1,i.y1);while(1){g=i["x"+h];f=i["y"+h];n=i["cx"+(h-1)];m=i["cy"+(h-1)];if(g!==e&&f!==e&&n!==e&&m!==e){o.quadraticCurveTo(n,m,g,f)}else{break}h+=1}b.closePath(o,i)}return this};d.fn.drawBezier=function(q){var r,p,m=d.extend({},b.prefs,q),k=2,h=1,j=0,i=0,o=0,g=0,n=0,f=0;for(p=0;p<this.length;p+=1){r=this[p].getContext("2d");b.setGlobals(r,m);r.beginPath();r.moveTo(m.x1,m.y1);while(1){j=m["x"+k];i=m["y"+k];o=m["cx"+h];g=m["cy"+h];n=m["cx"+(h+1)];f=m["cy"+(h+1)];if(j!==e&&i!==e&&o!==e&&g!==e&&n!==e&&f!==e){r.bezierCurveTo(o,g,n,f,j,i)}else{break}k+=1;h+=2}b.closePath(r,m)}return this};d.fn.drawText=function(g){var f,h,i=d.extend({},b.prefs,g);for(h=0;h<this.length;h+=1){f=this[h].getContext("2d");b.setGlobals(f,i);f.textBaseline=i.baseline;f.textAlign=i.align;f.font=i.font;f.strokeText(i.text,i.x,i.y);f.fillText(i.text,i.x,i.y);f.restore()}return this};d.fn.drawImage=function(j){var g,l,m=d.extend({},b.prefs,j),h=a.createElement("img"),i;h.src=m.source;function f(n){if(h.complete===true){i=h.width/h.height;if(m.width&&m.height){h.width=m.width;h.height=m.height}else{if(m.width&&!m.height){h.width=m.width;h.height=h.width/i}else{if(!m.width&&m.height){h.height=m.height;h.width=h.height*i}}}b.rotate(n,m,h.width,h.height);n.drawImage(h,m.x-h.width/2,m.y-h.height/2,h.width,h.height);n.restore();return true}else{return false}}function k(){f(g);if(m.load){m.load()}}for(l=0;l<this.length;l+=1){g=this[l].getContext("2d");b.setGlobals(g,m);if(m.load){h.onload=k}else{if(f(g)===false){h.onload=k}}}return this};d.fn.drawPolygon=function(k){var o,j,g=d.extend({},b.prefs,k),f,n,m,l,h;g.closed=true;f=(c.PI/2)+(c.PI/g.sides);n=(c.PI*2)/g.sides;for(j=0;j<this.length;j+=1){o=this[j].getContext("2d");b.setGlobals(o,g);if(g.sides>=3){b.rotate(o,g,g.radius,g.radius);o.beginPath();for(h=0;h<g.sides;h+=1){m=g.x+(g.radius*c.cos(f));l=g.y+(g.radius*c.sin(f));if(h===0){o.moveTo(m,l)}else{o.lineTo(m,l)}f+=n}b.closePath(o,g);o.restore()}}return this};d.fn.setPixels=function(n){var p,g,m,k,h=d.extend({},b.prefs,n),f,j,l,o;for(m=0;m<this.length;m+=1){g=this[m];p=g.getContext("2d");f=p.getImageData(h.x,h.y,h.width||g.width,h.height||g.height);j=f.data;l=j.length;o=[];if(h.each!==e){for(k=0;k<l;k+=4){o=h.each.call(g,j[k],j[k+1],j[k+2],j[k+3]);j[k]=o[0];j[k+1]=o[1];j[k+2]=o[2];j[k+3]=o[3]}}p.putImageData(f,h.x,h.y)}return this};b.queue=[];b.create=function(f){var g=d.extend({},b.prefs,f);b.queue.push(g);return g};d.fn.drawQueue=function(f){var g,h=b.queue.length,l,k,j;for(k=0;k<this.length;k+=1){g=this[k].getContext("2d");if(f===true){g.clearRect(0,0,this[k].width,this[k].height)}for(j=0;j<h;j+=1){l=b.queue[j];l.fn&&d.fn[l.fn].call(this,l)}}return this};b.retrofit=function(){b.retro=true;d.fn.drawQuadCurve=d.fn.drawQuad;d.fn.drawBezierCurve=d.fn.drawBezier;d.fn.canvasDefaults=b;d.fn.canvas=b;return d};return(d.jCanvas=b)}(jQuery,document,Math));